app-id: org.openkj.OpenKJ
runtime: org.kde.Platform
runtime-version: 5.15-24.08
sdk: org.kde.Sdk
command: openkj
add-extensions:
  org.freedesktop.Platform.ffmpeg-full:
  org.freedesktop.Platform.GStreamer.gstreamer-vaapi:
finish-args:
  - "--share=ipc"
  - "--socket=x11"
  - "--device=dri"
  - "--share=network"
  - "--socket=wayland"
  - "--socket=pulseaudio"
  - "--filesystem=host"
  - "--env=LADSPA_PATH=/app/lib/ladspa/"
  - "--env=QT_QPA_PLATFORM=xcb"
  - "--env=PATH=/app/lib/totem-pl-parser/bin/:/app/lib/codecs/bin/:/app/bin:/usr/bin"
modules:
  - name: liba52
    config-opts:
      - "--enable-shared"
      - "--disable-static"
    rm-configure: true
    cleanup:
      - "/bin/*a52*"
    sources:
      - type: archive
        url: "https://github.com/Distrotech/a52dec/archive/6cb8ac785c7b46671598e2061e704fdc61738727.tar.gz"
        sha256: 9200e212ba6838590e7d8ece2781014017f10739624b52e4bc92fe4185469b50
      - type: patch
        path: patches/a52dec-0.7.4-rpath64.patch
      - type: patch
        path: patches/a52dec-configure-optflags.patch
      - type: patch
        path: patches/liba52-silence.patch
      - type: patch
        path: patches/liba52-prefer-pic.patch
      - type: script
        commands:
          - "autoreconf -fiv"
        dest-filename: autogen.sh
  - name: libmpeg2
    config-opts:
      - "--enable-shared"
      - "--disable-static"
    rm-configure: true
    cleanup:
      - "/bin/*mpeg2*"
    sources:
      - type: archive
        url: "https://libmpeg2.sourceforge.io/files/libmpeg2-0.5.1.tar.gz"
        sha256: dee22e893cb5fc2b2b6ebd60b88478ab8556cb3b93f9a0d7ce8f3b61851871d4
      - type: patch
        path: patches/libmpeg2-inline.patch
      - type: script
        commands:
          - "autoreconf -fiv"
        dest-filename: autogen.sh
  - name: libass
    config-opts:
      - "--enable-shared"
      - "--disable-static"
    sources:
      - type: git
        url: "https://github.com/libass/libass.git"
        tag: 0.14.0
        commit: 73284b676b12b47e17af2ef1b430527299e10c17
      - type: script
        commands:
          - "autoreconf -fiv"
        dest-filename: autogen.sh
  - name: rubberband
    buildsystem: meson
    sources:
      - type: git
        url: https://github.com/breakfastquay/rubberband.git
        tag: v4.0.0
        commit: 1d95888bec3ae0a17c0c4af791810d5a63f6bc35
  - name: taglib
    buildsystem: cmake-ninja
    config-opts:
      - "-DBUILD_TESTING=OFF"
      - "-DBUILD_EXAMPLES=OFF"
    sources:
      - type: git
        url: https://github.com/taglib/taglib.git
        tag: v2.0.2
        commit: e3de03501ff66221d1f1f971022b248d5b38ba06
  - name: OpenKJ
    buildsystem: cmake-ninja
    config-opts:
      - "-DSPDLOG_USE_BUNDLED=true"
    sources:
      - type: git
        url: https://github.com/openkj/openkj.git
        commit: f116291e50f1fa46acf05135e164abd81d013ee0
